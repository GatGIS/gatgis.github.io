/* Mobile-first layout and modern touch-friendly styles */
:root{
  --bg:#ffffff;
  --muted:#f6f6f6;
  --accent:#007AFF;
  --danger:#e74c3c;
  --text:#111;
  --panel-gap:8px;
  --touch-size:50px;
  --font-base:16px;
  --panel-height: 40vh; /* Increased default height to ensure content fits */
}

/* Use 100% height to respect mobile browser UI. No more vh. */
html, body, #app {
  height: 100%;
  min-height: 100%;
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  overflow: hidden; /* Prevent body scroll */
}

#app {
  display: flex;
  flex-direction: column;
}

/* Ensure map area and panel respect the reduced app height */
/* The map now fills the remaining space above the panel */
.map-area {
  flex-grow: 1; /* Map takes up all available space */
  min-height: 120px;
  transition: height 260ms cubic-bezier(.22,.9,.25,1);
  width: 100%;
}

.panel-area {
  flex-shrink: 0; /* Panel should not shrink */
  /* Use max-height so JS inline height won't permanently override our limit.
     height:auto lets content determine layout while max-height enforces the panel size. */
  height: auto;
  max-height: var(--panel-height);
  /* ensure smooth transition when the variable changes */
  transition: max-height 200ms ease;
  box-shadow: 0 -6px 18px rgba(0,0,0,0.08);
  background: linear-gradient(180deg, rgba(255,255,255,0.98), #fff);
  padding: 10px 12px;
  box-sizing: border-box;
  overflow: hidden; /* Prevent content from overflowing */
}

/* If some script still writes an inline height, ensure our max-height limit is enforced.
   Remove !important once JS is fixed to respect the CSS variable. */
.panel-area {
  max-height: var(--panel-height) !important;
}

/* This is the main flex container for panel content. It will handle all scrolling. */
.mosys-panel {
  display: flex;
  flex-direction: column;
  gap: 8px;
  height: 100%;
  overflow-y: auto; /* Allow vertical scrolling only when content overflows */
}
#app.results-open { --panel-height: 70vh; }
/* When results are open, make the table container fill remaining space and scroll */
#app.results-open #mosys-tableContainer {
  flex-grow: 1; /* Allow this element to grow */
  min-height: 0; /* Necessary for flex-grow to work correctly in a column */
}


/* header contains buttons on the right */
.mosys-header {
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:8px;
  position: relative;
}

/* top actions (buttons in header) */
.top-actions {
  display:flex;
  gap:8px;
  align-items:center;
}

/* small variant if there's little space */
.top-actions .mosys-btn { min-height:44px; padding:8px 10px; }

/* ensure controls can wrap and shrink */
.controls { display:flex; gap:8px; width:100%; flex-wrap:wrap; align-items:center; }
.controls input[type="text"]{ flex:1 1 calc(50% - 8px); min-width:0; height:48px; padding:10px; box-sizing:border-box; }

/* keep buttons row but now not required to be at bottom */
.buttons-row { display:flex; gap:10px; width:100%; }

/* webAnswer wraps and is scrollable inside panel when expanded */
.mosys-result { word-break: break-word; white-space: pre-wrap; overflow-wrap: anywhere; font-size:14px; padding-top:6px; }

/* table compact */
.mosys-table { width:100%; border-collapse:collapse; font-size:14px; }
.mosys-table td { padding:10px 8px; border-bottom:1px solid #f2f2f6; }

/* Floating layer menu toggled by the Layers button */
.layer-menu {
  position: absolute;
  top: 48px;            /* below the header/top-actions */
  right: 12px;
  background: #ffffff;
  border: 1px solid rgba(0,0,0,0.06);
  padding: 8px 10px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.08);
  border-radius: 6px;
  z-index: 1400;
  min-width: 140px;
  font-size: 14px;
}
.layer-menu label { display: block; margin: 4px 0; cursor: pointer; }
/* ensure the floating menu is compact on small screens */
@media (max-width:420px){
  .controls input[type="text"] { flex-basis:100%; }
  .top-actions .mosys-btn { min-height:48px; padding:10px 12px; font-size:15px; }
  .layer-menu { right: 8px; left: 8px; top: 56px; min-width: auto; }
}

/* Map controls floating on top-right */
.map-controls {
  position: absolute;
  top: 10px;
  right: 10px;
  z-index: 1400;
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 6px;
  pointer-events: auto;
}

.map-controls .map-btn {
  background: #fff;
  border: 1px solid rgba(0,0,0,0.08);
  padding: 6px 10px;
  border-radius: 6px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.08);
  cursor: pointer;
  font-size: 13px;
}

.layer-menu {
  margin-top: 6px;
  background: #fff;
  border: 1px solid rgba(0,0,0,0.06);
  padding: 8px 10px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.08);
  border-radius: 6px;
  min-width: 150px;
  text-align: left;
}

/* Modern button styles for Drill/Refresh */
.mosys-btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding: 10px 12px;
  border-radius: 10px;
  border: 1px solid transparent;
  font-weight: 600;
  font-size: 14px;
  cursor: pointer;
  transition: transform 120ms ease, box-shadow 120ms ease, opacity 120ms ease;
  user-select: none;
  box-shadow: 0 2px 6px rgba(8,15,30,0.06);
  background: #fafafa;
}

.mosys-btn:active { transform: translateY(1px); }

/* Primary / Drill */
.mosys-btn.primary {
  background: linear-gradient(180deg,#2d8cff,#1b6fe6);
  color: #fff;
  box-shadow: 0 6px 18px rgba(27,111,230,0.18);
  border-color: rgba(27,111,230,0.18);
}
.mosys-btn.primary:hover { transform: translateY(-1px); }

/* Secondary / Refresh */
.mosys-btn.secondary {
  background: #fff;
  color: #223;
  border: 1px solid rgba(34,34,34,0.08);
  box-shadow: 0 4px 10px rgba(0,0,0,0.04);
}
.mosys-btn.secondary:hover { transform: translateY(-1px); }

/* Small circular Close (X) button used in header */
.mosys-close {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 38px;
  height: 38px;
  padding: 0;
  margin-left: 6px;
  border-radius: 10px;
  background: transparent;
  border: 1px solid rgba(0,0,0,0.06);
  color: #223;
  font-size: 16px;
  line-height: 1;
  cursor: pointer;
  transition: background 120ms ease, transform 120ms ease;
}
.mosys-close:hover { background: rgba(0,0,0,0.04); transform: translateY(-1px); }


/* Make the close icon slightly larger on very small screens */
@media (max-width:420px){
  .mosys-close { width:40px; height:40px; border-radius:9px; font-size:18px; }
}

/* small-screen tweaks */
@media (max-width:420px){
  :root { --bottom-spacer-height: 64px; }
  .mosys-btn { padding: 10px; font-size: 13px; border-radius: 8px; }
}

/* Small GPS control placed on map (uses OpenLayers control container) */
.ol-gps {
  position: absolute;
  top: 10px;
  right: 10px; /* align with LayerSwitcher on the right */
  z-index: 2000;
  display: flex;
  flex-direction: column;
  align-items: center;
}
.ol-gps button {
  width: 36px;
  height: 36px;
  border-radius: 8px;
  border: 1px solid rgba(0,0,0,0.08);
  background: #fff;
  box-shadow: 0 6px 18px rgba(0,0,0,0.08);
  cursor: pointer;
  font-size: 16px;
  line-height: 1;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0;
}
.ol-gps button:hover { transform: translateY(-2px); }
.ol-gps button:focus { outline: none; box-shadow: none; }
.ol-gps button, .ol-gps button:active { -webkit-tap-highlight-color: transparent; }
.ol-gps button, .ol-gps button:focus, .ol-gps button:active {
  -webkit-appearance: none;
  appearance: none;
  background: #fff !important; /* keep white background even when focused/active */
  color: inherit;
  box-shadow: 0 6px 18px rgba(0,0,0,0.08);
}
.ol-gps-accuracy {
  margin-top: 4px;
  font-size: 12px;
  color: #007AFF;
  background: rgba(255,255,255,0.95);
  padding: 2px 6px;
  border-radius: 8px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.06);
  white-space: nowrap;
}

/* ensure LayerSwitcher sits at top-right with small offset */
.ol-layerswitcher, .layer-switcher, .layerswitcher { top: 76px !important; right: 10px !important; }

/* Move OpenLayers rotate (north) control to top-left under the zoom controls
  so it doesn't overlap map-top-right GPS control. */
.ol-zoom { top: 56px !important; left: 10px !important; right: auto !important; }
.ol-rotate { top: 100px !important; left: 10px !important; right: auto !important; }

/* Legend-All control positioned above the zoom controls (same column). Match zoom button size and style */
.ol-legendall { position: absolute; top: 10px !important; left: 10px !important; z-index: 2000; }
.ol-legendall button {
  width: 36px;
  height: 36px;
  border-radius: 6px;
  border: 1px solid rgba(0,0,0,0.08);
  background: linear-gradient(180deg,#fafafa,#ffffff);
  box-shadow: 0 6px 18px rgba(0,0,0,0.08);
  cursor: pointer;
  color: #223;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
}
.ol-legendall button:hover { transform: translateY(-2px); background: linear-gradient(180deg,#fff,#f7fbff); }
.ol-legendall button:focus { outline: none; box-shadow: none; }

/* small popup label near marker showing precision briefly */
.gps-precision {
  background: rgba(255,255,255,0.95);
  color: #007AFF;
  padding: 4px 8px;
  border-radius: 6px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.12);
  font-size: 13px;
  pointer-events: none;
}

/* small spinner used inside GPS control */
.gps-spinner {
  width: 18px;
  height: 18px;
  border-radius: 50%;
  border: 2px solid rgba(0,0,0,0.08);
  border-top-color: #007AFF;
  animation: spin 1s linear infinite;
  box-sizing: border-box;
  margin-top: 4px;
}
.mosys-spinner {
  width: 18px;
  height: 18px;
  border-radius: 50%;
  /* visible on light backgrounds: subtle dark ring with accent on top */
  border: 3px solid rgba(0,0,0,0.12);
  border-top-color: var(--accent);
  animation: spin 1s linear infinite;
  box-sizing: border-box;
  vertical-align: middle;
}
.mosys-spinner-overlay {
  position: absolute;
  inset: 0; /* fill the button */
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 30;
  pointer-events: none;
}

/* left-inline spinner used beside the Drill button */
.mosys-spinner-left {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  margin-right: 8px;
  vertical-align: middle;
  width: 18px;
  height: 18px;
}

@keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

/* Styles migrated from drill/index.html <style> block to central stylesheet */
/* ensure map fills available area */
#map { width: 100%; height: 80vh; }
#panel { width: 100%; height: 20vh; }
#app.results-open #map { height: 30vh; }
#app.results-open #panel { height: 70vh; }
/* Add transitions for smooth height change */
#map, #panel { transition: height 0.3s; }

/* Spacer styles moved from index.html */
#bottomSpacer { height: var(--spacer-height, 20px); visibility: hidden; }

/* utility hidden class used by JS to toggle element visibility */
.hidden { display: none !important; }

/* Quaternary WMS info block displayed above MOSYS results */
.quaternary-info {
  font-size: 14px;
  color: #0b3d91;
  border-radius: 6px;
}

.pamatiezi-info { font-size: 14px; color: #663c00; }

/* Legend popup shown when user clicks the small '?' next to a layer name */
.legend-popup {
  position: fixed;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  z-index: 5000;
  background: rgba(255,255,255,0.98);
  border: 1px solid rgba(0,0,0,0.08);
  box-shadow: 0 12px 40px rgba(0,0,0,0.18);
  border-radius: 10px;
  max-width: 92vw;
  max-height: 80vh;
  overflow-y: auto;
  overflow-x: hidden; /* keep overall popup from creating horizontal page scroll */
  padding: 10px;
  box-sizing: border-box;
}
.legend-popup.hidden { display: none; }
.legend-popup .legend-inner { display:flex; flex-direction:column; gap:8px; }
.legend-popup .legend-content { display:flex; flex-direction:column; gap:12px; align-items:center; padding:12px; box-sizing: border-box; }
/* Each legend item is a full-width block that centers the image */
.legend-popup .legend-item { width: 100%; display:block; }
.legend-popup .legend-item .legend-title { width: 100%; text-align: left; font-weight: 700; margin-bottom: 6px; }
.legend-popup .legend-item .legend-embed { width: 100%; display:block; overflow-x: auto; -webkit-overflow-scrolling: touch; }
.legend-popup .legend-item .legend-embed img {
  /* Allow natural image width, but constrain height; user can scroll horizontally if image wider than popup */
  width: auto;
  max-width: none;
  height: auto;
  max-height: 85vh;
  object-fit: contain;
  display: block;
  margin: 0 auto;
  image-rendering: -webkit-optimize-contrast;
}

/* Mobile: use larger width for legends so they are readable */
@media (max-width: 600px) {
  .legend-popup {
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    width: 90vw;
    max-width: 90vw;
    max-height: 90vh;
    padding: 12px;
    box-sizing: border-box;
  }
  /* Do not force width on mobile; allow horizontal scrolling if legend is wider */
  .legend-popup .legend-item .legend-embed img { width: auto; max-width: none; }
}
.legend-popup .legend-close { align-self:flex-end; background:transparent; border:1px solid rgba(0,0,0,0.06); border-radius:8px; padding:6px 8px; cursor:pointer; }
.legend-loading { color:#666; font-size:14px; padding:12px; }
.legend-error { color:#a33; font-size:14px; padding:12px; }

/* small legend button appended next to layer label inside the LayerSwitcher */
.ls-legend-btn {
  margin-left: 8px;
  background: rgba(0,0,0,0.06);
  border: none;
  border-radius: 6px;
  width: 20px;
  height: 20px;
  font-size: 12px;
  line-height: 1;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}
.ls-legend-btn:hover { background: rgba(0,0,0,0.12); }